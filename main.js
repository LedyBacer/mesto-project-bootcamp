(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};function e(t){"Escape"===t.key&&r(document.querySelector(".popup_opened"))}function n(t){t.classList.add("popup_opened"),window.addEventListener("keydown",e)}function r(t){t.classList.remove("popup_opened"),window.removeEventListener("keydown",e)}function o(t,e){t.classList.add(e),t.setAttribute("disabled","")}function i(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}function c(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";t?e.setAttribute("value","".concat(r)):e.setAttribute("value","".concat(n))}function a(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранение...";e.preventDefault();var r=e.submitter,o=r.getAttribute("value");c(!0,r,o,n),t(e).catch((function(t){console.error("Ошибка: ".concat(t))})).finally((function(){c(!1,r,o)}))}t.d({},{kb:()=>q,OP:()=>D,iu:()=>x,oW:()=>P,k3:()=>T,bg:()=>N,lx:()=>I,D6:()=>A,RX:()=>w});var u=function(t,e,n){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?function(t,e){t.classList.remove(e),t.removeAttribute("disabled","")}(e,n.inactiveButtonClass):o(e,n.inactiveButtonClass)};function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function s(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function f(t,e,n){return(e=function(t){var e=function(t,e){if("object"!==l(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!==l(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===l(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var d={baseUrl:"https://mesto.nomoreparties.co/v1/wbf-cohort-8",headers:{authorization:"15b761dd-2148-487a-a7b8-1576e91a7d6c","Content-Type":"application/json"}};function m(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?s(Object(n),!0).forEach((function(e){f(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):s(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({headers:d.headers},e);return fetch(d.baseUrl+t,n).then(i)}function p(t,e,n,r){t.querySelector(".card-elements__item-like-count").textContent=n.length,n.find((function(t){return t._id===e}))?r.classList.add("card-elements__item-like_active"):r.classList.remove("card-elements__item-like_active")}function v(t,e,r,o,i,c){var a=D.querySelector(".card-elements__item").cloneNode(!0),u=a.querySelector(".card-elements__item-image"),l=a.querySelector(".card-elements__item-like");return a.querySelector(".card-elements__item-text").textContent=t,u.setAttribute("style","background-image:url('".concat(e,"')")),p(a,o,c,l),function(t,e,n,r,o){o.addEventListener("click",(function(n){n.target.classList.contains("card-elements__item-like_active")?function(t){return m("/cards/likes/".concat(t),{method:"DELETE"})}(r).then((function(n){return p(t,e,n.likes,o)})).catch((function(t){return console.error("Ошибка: ".concat(t))})):function(t){return m("/cards/likes/".concat(t),{method:"PUT"})}(r).then((function(n){return p(t,e,n.likes,o)})).catch((function(t){return console.error("Ошибка: ".concat(t))}))}))}(a,o,0,i,l),function(t,e,n,r){var o=t.querySelector(".card-elements__item-trash");e===n?o.addEventListener("click",(function(t){(function(t){return m("/cards/".concat(t),{method:"DELETE"})})(r).then((function(){return t.target.closest(".card-elements__item").remove()})).catch((function(t){return console.error("Ошибка: ".concat(t))}))})):o.setAttribute("style","display:none")}(a,r,o,i),function(t,e,r){t.addEventListener("click",(function(){N.textContent=e,I.setAttribute("alt","Фото: ".concat(e)),I.setAttribute("src","".concat(r)),n(T)}))}(u,t,e),a}function y(t,e,n,r,o,i,c,a){var u=v(t,e,o,i,c,a);"end"===r?n.append(u):n.prepend(u)}function b(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var _,g=document.querySelector(".page"),h=g.querySelector(".profile"),S=h.querySelector(".profile__add-button"),E=h.querySelector(".profile__edit-button"),k=h.querySelector(".profile__avatar"),O=document.getElementById("add-popup"),L=document.getElementById("avatar-popup"),C=g.querySelectorAll(".popup__close-button"),j=g.querySelector(".card-elements__item-grid"),w=h.querySelector(".profile__name"),A=h.querySelector(".profile__description"),q=document.forms["mesto-form"],P=document.forms["profile-form"],x=document.forms["avatar-form"],B=document.getElementById("edit-popup"),D=document.getElementById("card-template").content,T=document.getElementById("image-popup"),I=T.querySelector(".popup__image"),N=T.querySelector(".popup__bottom-text");function U(t){var e;e=function(t){a((function(t){return(e=t.target.elements["form-name"].value,n=t.target.elements["form-about"].value,m("/users/me",{method:"PATCH",body:JSON.stringify({name:e,about:n})})).then((function(t){w.textContent=t.name,A.textContent=t.about,r(B)}));var e,n}),t)},P.elements["form-name"].value=w.textContent,P.elements["form-about"].value=A.textContent,P.addEventListener("submit",(function(t){e(t)})),q.addEventListener("submit",(function(e){!function(e){a((function(e){return(n=e.target.elements.description.value,o=e.target.elements.url.value,m("/cards",{method:"POST",body:JSON.stringify({name:n,link:o})})).then((function(n){y(n.name,n.link,j,"start",n.owner._id,t,n._id,n.likes),r(O),e.target.reset()}));var n,o}),e)}(e)})),x.addEventListener("submit",(function(t){!function(t){a((function(t){return(e=t.target.elements["form-avatar-url"].value,m("/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:e})})).then((function(e){k.setAttribute("style","background-image:url('".concat(e.avatar,"')")),r(L),t.target.reset()}));var e}),t)}(t)}))}Promise.all([m("/users/me"),m("/cards")]).then((function(t){var e,n,r=(n=2,function(t){if(Array.isArray(t))return t}(e=t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,o,i,c,a=[],u=!0,l=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(a.push(r.value),a.length!==e);u=!0);}catch(t){l=!0,o=t}finally{try{if(!u&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw o}}return a}}(e,n)||function(t,e){if(t){if("string"==typeof t)return b(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b(t,e):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),o=r[0],i=r[1],c=function(t){return w.textContent=t.name,A.textContent=t.about,k.setAttribute("style","background-image:url('".concat(t.avatar,"')")),t._id}(o);!function(t,e){e.forEach((function(e){y(e.name,e.link,j,"end",e.owner._id,t,e._id,e.likes)}))}(c,i),U(c)})).catch((function(t){console.log(t)})),_={formSelector:".popup__form",inputSelector:".popup__form-input",submitButtonSelector:".popup__form-submit",inactiveButtonClass:"popup__form-submit_disabled",inputErrorClass:"popup__form-input_type_error",errorClass:"popup__input-error_visible"},Array.from(document.querySelectorAll(_.formSelector)).forEach((function(t){t.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var n=Array.from(t.querySelectorAll(e.inputSelector)),r=t.querySelector(e.submitButtonSelector);u(n,r,e),t.addEventListener("reset",(function(){o(r,e.inactiveButtonClass)})),n.forEach((function(o){o.addEventListener("input",(function(){!function(t,e,n){e.validity.valid?function(t,e,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=""}(t,e,n):function(t,e,n,r){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(t,e,e.validationMessage,n)}(t,o,e),u(n,r,e)}))}))}(t,_)})),C.forEach((function(t){var e=t.closest(".popup");t.addEventListener("click",(function(){return r(e)})),e.addEventListener("mousedown",(function(t){t.target===e&&r(e)}))})),S.addEventListener("click",(function(){n(O)})),E.addEventListener("click",(function(){n(B)})),k.addEventListener("click",(function(){n(L)}))})();